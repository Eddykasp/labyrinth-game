<canvas id="canvas" width="900" height="600">
    Your browser doesn't support the canvas element
</canvas>
<script>

var Tile = function(x, y){
    this.x = x;
    this.y = y;
    this.type = 'TILE';
    this.draw = function(){};
}

var TileFloor = function(x, y){
    var tile = new Tile(x, y);
    tile.type = 'TILE_FLOOR';
    tile.draw = function(ctx){
        ctx.fillStyle = '#aaa';
        ctx.fillRect(this.x*30 + 1, this.y*30 + 1, 28, 28);
    }
    return tile;
}

var TileWall = function(x, y){
    var tile = new Tile(x, y);
    tile.type = 'TILE_WALL';
    tile.draw = function(ctx){
        ctx.fillStyle = '#aaa';
        ctx.fillRect(this.x*30 + 1, this.y*30 + 1, 28, 28);
        ctx.fillStyle = '#333';
        ctx.fillRect(this.x*30 + 3, this.y*30 + 3, 24, 24);
    }
    return tile;
}

var canv;
var ctx;
var grid = [];
var gridWidth = 0;
var gridHeight = 0;
var player = {
    x: 0,
    y: 0,
    draw: function(ctx){
        ctx.fillStyle = '#fff';
        ctx.fillRect(this.x*30 + 10, this.y*30 + 10, 10, 10)
    },
    move: function(x, y){
        var newX = this.x;
        newX += x;
        var newY = this.y;
        newY += y;

        if(newX < 0){
            newX = gridWidth + newX % gridWidth;
        } else if(newX > gridWidth - 1){
            newX = newX % gridWidth;
        }
        if(newY < 0){
            newY = gridHeight + newY % gridHeight;
        } else if(newY > gridHeight - 1){
            newY = newY % gridHeight;
        }

        if(grid[newX][newY].type === 'TILE_FLOOR'){
            this.x = newX;
            this.y = newY;
        }
    }
}

window.onload = function(){
    canv = document.getElementById('canvas');
    ctx = canv.getContext('2d');

    document.addEventListener('keydown', keyDown);

    init();
    refresh();
    window.intervalId = setInterval(update, 1000/30);
};

function init(){
    gridWidth = Math.floor(canv.width/30);
    gridHeight = Math.floor(canv.height/30);
    ctx.fillStyle = '#000';
    ctx.fillRect(0, 0, canv.width, canv.height);
}

function refresh(){
    for(i = 0; i < gridWidth; i++){
        grid.push([]);
        for(j = 0; j < gridHeight; j++){
            grid[i].push(new TileFloor(i, j));
        }
    }
}

function update(){
    for(i = 0; i < grid.length; i++){
        for(j = 0; j < grid[i].length; j++){
            //console.log(j);
            grid[i][j].draw(ctx);
        }
    }
    player.draw(ctx);
}

function keyDown(evt){
    switch(evt.keyCode){
    case 37:
        player.move(-1, 0);
        break;
    case 38:
        player.move(0, -1);
        break;
    case 39:
        player.move(1, 0);
        break;
    case 40:
        player.move(0, 1);
        break;
    }
}

</script>
